<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ­£é€šç§‘æŠ€ - ç”¢å“ç›®éŒ„ç³»çµ±</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <style>
        body { font-family: "Microsoft JhengHei", sans-serif; background-color: #f8fafc; }
        .brand-orange { color: #F97316; }
        .bg-orange { background-color: #F97316; }
        .loading-spinner { border-top-color: #F97316; animation: spinner 1s linear infinite; }
        @keyframes spinner { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .card-hover:hover { transform: translateY(-5px); transition: all 0.3s ease; box-shadow: 0 10px 20px rgba(0,0,0,0.05); }
        /* å¸¸å‚™å“æ¨™ç±¤ç™¼å…‰æ•ˆæœ */
        .stock-badge { background: linear-gradient(135deg, #22c55e 0%, #15803d 100%); }
    </style>
</head>
<body class="text-gray-800">

    <nav class="bg-white shadow-sm border-b-4 border-orange sticky top-0 z-50 px-6 py-4 flex justify-between items-center">
        <h1 class="text-xl font-black brand-orange tracking-tighter">æ­£é€šç§‘æŠ€ <span class="text-gray-300 font-light mx-2">|</span> <span class="text-gray-500 font-bold text-lg">PRODUCT CATALOG</span></h1>
        <div id="itemCount" class="text-xs font-bold bg-orange/10 text-orange-600 px-3 py-1 rounded-full border border-orange/20">é€£ç·šä¸­...</div>
    </nav>

    <section class="bg-white border-b p-6 shadow-sm">
        <div class="max-w-7xl mx-auto flex flex-col gap-4">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div>
                    <label class="block text-[10px] font-bold text-gray-400 mb-1 ml-1">å¿«é€Ÿæœå°‹ (å‹è™Ÿ/åç¨±)</label>
                    <input type="text" id="keywordSearch" oninput="filterData()" placeholder="ğŸ” æœå°‹é—œéµå­—..." 
                           class="w-full border-2 border-gray-100 p-3 rounded-xl focus:border-orange outline-none bg-gray-50 transition-all text-sm">
                </div>
                
                <div>
                    <label class="block text-[10px] font-bold text-gray-400 mb-1 ml-1">å“ç‰Œ</label>
                    <select id="brandFilter" onchange="updateCategoryMenu(); filterData();" 
                            class="w-full border-2 border-gray-100 p-3 rounded-xl focus:border-orange outline-none bg-white text-sm cursor-pointer">
                        <option value="">æ‰€æœ‰å“ç‰Œ</option>
                    </select>
                </div>

                <div>
                    <label class="block text-[10px] font-bold text-gray-400 mb-1 ml-1">ç”¢å“åˆ†é¡</label>
                    <select id="categoryFilter" onchange="filterData()" 
                            class="w-full border-2 border-gray-100 p-3 rounded-xl focus:border-orange outline-none bg-white text-sm cursor-pointer">
                        <option value="">æ‰€æœ‰åˆ†é¡</option>
                    </select>
                </div>
            </div>

            <div class="flex items-center gap-2 ml-1">
                <input type="checkbox" id="stockOnly" onchange="filterData()" class="w-4 h-4 text-orange-600 border-gray-300 rounded focus:ring-orange accent-orange-500">
                <label for="stockOnly" class="text-sm font-bold text-gray-600 cursor-pointer">åƒ…é¡¯ç¤ºå¸¸å‚™å“ (Y)</label>
            </div>
        </div>
    </section>

    <main class="max-w-7xl mx-auto p-6 min-h-screen">
        <div id="loader" class="flex flex-col items-center py-20">
            <div class="loading-spinner w-10 h-10 border-4 border-gray-200 rounded-full mb-4"></div>
            <p class="text-gray-400 font-medium animate-pulse">æ­£åœ¨è®€å–é›²ç«¯ç”¢å“è³‡æ–™...</p>
        </div>

        <div id="productGrid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6"></div>

        <div id="noData" class="hidden text-center py-24">
            <div class="text-5xl mb-4">ğŸ”</div>
            <p class="text-gray-400 font-bold text-lg">æ‰¾ä¸åˆ°ç›¸ç¬¦çš„ç”¢å“</p>
        </div>
    </main>

    <footer class="bg-white border-t border-gray-100 py-10 text-center text-gray-400 text-xs">
        &copy; æ­£é€šç§‘æŠ€ Genton Technology - ç”¢å“ç›®éŒ„ç³»çµ± v2.1
    </footer>

    <script>
        const csvUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSEaN95uQx-YbX1GKTcX8Og3GhmvgVNFgGocAopyg7bD6TvyUOOWUgiJAdbvX0GAKHpfs6dw0w2TGH3/pub?output=csv';
        let allProducts = [];
        let colMap = { brand: 'å“ç‰Œ', cat: 'åˆ†é¡', part: 'æ–™è™Ÿ', name: 'å“é …', img: 'åœ–ç‰‡æª”å', spec: 'å‹éŒ„æª”å', cert: 'èªè­‰æª”å', stock: 'å¸¸å‚™å“' };

        function init() {
            Papa.parse(csvUrl, {
                download: true,
                header: true,
                skipEmptyLines: true,
                complete: function(results) {
                    const data = results.data;
                    if(data.length > 0) {
                        const keys = Object.keys(data[0]);
                        colMap.brand = keys.find(k => k.includes('å“ç‰Œ')) || 'å“ç‰Œ';
                        colMap.cat = keys.find(k => k.includes('åˆ†é¡')) || 'åˆ†é¡';
                        colMap.part = keys.find(k => k.includes('æ–™è™Ÿ')) || 'æ–™è™Ÿ';
                        colMap.name = keys.find(k => k.includes('å“é …')) || 'å“é …';
                        colMap.img = keys.find(k => k.includes('åœ–ç‰‡')) || 'åœ–ç‰‡æª”å';
                        colMap.spec = keys.find(k => k.includes('å‹éŒ„')) || 'å‹éŒ„æª”å';
                        colMap.cert = keys.find(k => k.includes('èªè­‰')) || 'èªè­‰æª”å';
                        colMap.stock = keys.find(k => k.includes('å¸¸å‚™å“')) || 'å¸¸å‚™å“'; // è‡ªå‹•åµæ¸¬å¸¸å‚™å“æ¬„ä½

                        allProducts = data.filter(p => p[colMap.brand] && p[colMap.part]);
                        buildBrandMenu();
                        updateCategoryMenu();
                        filterData();
                        document.getElementById('loader').classList.add('hidden');
                    }
                }
            });
        }

        function buildBrandMenu() {
            const bSelect = document.getElementById('brandFilter');
            const brands = [...new Set(allProducts.map(p => p[colMap.brand]))].filter(Boolean).sort();
            brands.forEach(b => bSelect.add(new Option(b, b)));
        }

        function updateCategoryMenu() {
            const bValue = document.getElementById('brandFilter').value;
            const cSelect = document.getElementById('categoryFilter');
            cSelect.innerHTML = '<option value="">æ‰€æœ‰åˆ†é¡</option>';
            const scope = bValue === "" ? allProducts : allProducts.filter(p => p[colMap.brand] === bValue);
            const cats = [...new Set(scope.map(p => p[colMap.cat]))].filter(Boolean).sort();
            cats.forEach(c => cSelect.add(new Option(c, c)));
        }

        function filterData() {
            const kw = document.getElementById('keywordSearch').value.toLowerCase();
            const b = document.getElementById('brandFilter').value;
            const c = document.getElementById('categoryFilter').value;
            const sOnly = document.getElementById('stockOnly').checked;
            const grid = document.getElementById('productGrid');
            
            const filtered = allProducts.filter(p => {
                const searchStr = (p[colMap.name] + p[colMap.part] + p[colMap.cat]).toLowerCase();
                const matchK = searchStr.includes(kw);
                const matchB = b === "" || p[colMap.brand] === b;
                const matchC = c === "" || p[colMap.cat] === c;
                const matchS = sOnly ? (p[colMap.stock] === 'Y' || p[colMap.stock] === 'y') : true;
                return matchK && matchB && matchC && matchS;
            });

            grid.innerHTML = '';
            document.getElementById('itemCount').innerText = `æ‰¾åˆ° ${filtered.length} ä»¶ç”¢å“`;
            document.getElementById('noData').classList.toggle('hidden', filtered.length > 0);

            filtered.forEach(p => {
                const imgSrc = p[colMap.img] ? `images/${p[colMap.img]}` : 'https://placehold.co/400x300?text=No+Image';
                
                // åˆ¤æ–·æ˜¯å¦ç‚ºå¸¸å‚™å“
                const isStock = p[colMap.stock] === 'Y' || p[colMap.stock] === 'y';
                const stockBadge = isStock ? `<div class="absolute top-2 right-2 stock-badge text-white text-[10px] font-black px-2 py-1 rounded-lg shadow-md z-10">â˜… å¸¸å‚™å“</div>` : '';

                let specPath = p[colMap.spec] || '#';
                if (specPath !== '#' && !specPath.includes('/')) specPath = `pdf1/${specPath}`;
                let certPath = p[colMap.cert] || '#';
                if (certPath !== '#' && !certPath.includes('/')) certPath = `pdftl/${certPath}`;

                grid.innerHTML += `
                    <div class="card-hover bg-white rounded-2xl shadow-sm border border-gray-100 p-4 flex flex-col h-full relative">
                        ${stockBadge}
                        <div class="h-40 flex items-center justify-center bg-gray-50 rounded-xl mb-4 p-2 overflow-hidden">
                            <img src="${imgSrc}" class="max-w-full max-h-full object-contain" onerror="this.src='https://placehold.co/400x300?text=Wait+Image'">
                        </div>
                        <div class="flex-grow">
                            <div class="flex items-center justify-between mb-1">
                                <span class="text-[10px] bg-orange-500 text-white px-2 py-0.5 rounded font-black tracking-widest">${p[colMap.brand]}</span>
                                <span class="text-[10px] text-gray-400 font-bold uppercase">${p[colMap.cat]}</span>
                            </div>
                            <div class="font-mono font-bold text-orange-600 text-xs mt-2">${p[colMap.part]}</div>
                            <div class="text-sm font-bold text-gray-700 mt-1 line-clamp-2 h-10 leading-snug">${p[colMap.name]}</div>
                        </div>
                        <div class="grid grid-cols-2 gap-2 mt-4 pt-4 border-t border-gray-50">
                            <button onclick="openFile('${specPath}', 'ç›®å‰æš«ç„¡å‹éŒ„æª”æ¡ˆ')" class="py-2 bg-gray-50 hover:bg-orange hover:text-white text-gray-500 rounded-lg text-[10px] font-black transition-all">ğŸ“œ å‹éŒ„</button>
                            <button onclick="openFile('${certPath}', 'ç›®å‰æš«ç„¡èªè­‰è³‡æ–™')" class="py-2 bg-gray-50 hover:bg-blue-600 hover:text-white text-gray-500 rounded-lg text-[10px] font-black transition-all">ğŸ›¡ï¸ èªè­‰</button>
                        </div>
                    </div>`;
            });
        }

        function openFile(path, msg) {
            if (path === '#' || path === '') alert(msg);
            else window.open(path, '_blank');
        }

        init();
    </script>
</body>
</html>