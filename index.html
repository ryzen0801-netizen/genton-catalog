<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ­£é€šç§‘æŠ€ - ç”¢å“æŸ¥è©¢ç³»çµ±</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <style>
        body { font-family: "Microsoft JhengHei", "å¾®è»Ÿæ­£é»‘é«”", sans-serif; background-color: #fcfcfc; }
        .brand-orange { color: #F97316; }
        .bg-orange { background-color: #F97316; }
        .border-orange { border-color: #F97316; }
        .loading-spinner { border-top-color: #F97316; animation: spinner 1s linear infinite; }
        @keyframes spinner { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .product-card:hover { transform: translateY(-4px); transition: all 0.3s ease; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); }
    </style>
</head>
<body class="text-gray-800">

    <nav class="bg-white shadow-md border-b-4 border-orange sticky top-0 z-50 px-6 py-4">
        <div class="max-w-7xl mx-auto flex flex-col md:flex-row justify-between items-center gap-4">
            <h1 class="text-2xl font-black brand-orange flex items-center">
                æ­£é€šç§‘æŠ€ <span class="text-gray-400 text-lg font-light ml-2">| ç”¢å“ç›®éŒ„</span>
            </h1>
            <div id="itemCount" class="text-sm bg-orange/10 text-orange-600 px-4 py-1 rounded-full font-bold">
                è³‡æ–™è®€å–ä¸­...
            </div>
        </div>
    </nav>

    <section class="bg-gray-50 border-b border-gray-200 p-6">
        <div class="max-w-7xl mx-auto grid grid-cols-1 md:grid-cols-4 gap-4">
            <div class="md:col-span-2">
                <label class="block text-xs font-bold text-gray-500 mb-1 ml-1">å¿«é€Ÿæœå°‹ (å‹è™Ÿã€è¦æ ¼ã€åç¨±)</label>
                <input type="text" id="keywordSearch" placeholder="ğŸ” è¼¸å…¥é—œéµå­—..." 
                       class="w-full border-2 border-gray-200 p-3 rounded-xl focus:border-orange outline-none bg-white transition-all shadow-sm">
            </div>
            
            <div>
                <label class="block text-xs font-bold text-gray-500 mb-1 ml-1">å“ç‰Œ</label>
                <select id="brandFilter" class="w-full border-2 border-gray-200 p-3 rounded-xl focus:border-orange outline-none bg-white shadow-sm cursor-pointer">
                    <option value="">æ‰€æœ‰å“ç‰Œ</option>
                </select>
            </div>

            <div>
                <label class="block text-xs font-bold text-gray-500 mb-1 ml-1">ç”¢å“åˆ†é¡</label>
                <select id="categoryFilter" class="w-full border-2 border-gray-200 p-3 rounded-xl focus:border-orange outline-none bg-white shadow-sm cursor-pointer">
                    <option value="">æ‰€æœ‰åˆ†é¡</option>
                </select>
            </div>
        </div>
    </section>

    <main class="max-w-7xl mx-auto p-6 min-h-[60vh]">
        <div id="loader" class="flex flex-col items-center py-20">
            <div class="loading-spinner w-12 h-12 border-4 border-gray-200 rounded-full mb-4"></div>
            <p class="text-gray-500 font-medium">æ­£åœ¨é€£æ¥é›²ç«¯è³‡æ–™åº«...</p>
        </div>

        <div id="productGrid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6"></div>

        <div id="noData" class="hidden text-center py-20">
            <div class="text-6xl mb-4">ğŸš«</div>
            <p class="text-xl text-gray-400 font-bold">æ‰¾ä¸åˆ°ç›¸ç¬¦çš„ç”¢å“</p>
        </div>
    </main>

    <footer class="bg-white border-t border-gray-100 py-8 text-center text-gray-400 text-sm">
        &copy; 2024 æ­£é€šç§‘æŠ€ Genton Technology
    </footer>

    <script>
        const csvUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSEaN95uQx-YbX1GKTcX8Og3GhmvgVNFgGocAopyg7bD6TvyUOOWUgiJAdbvX0GAKHpfs6dw0w2TGH3/pub?output=csv';
        let allProducts = [];

        // 1. åˆå§‹åŒ–
        function init() {
            Papa.parse(csvUrl, {
                download: true,
                header: true,
                skipEmptyLines: true,
                complete: function(results) {
                    allProducts = results.data.filter(p => p['å“ç‰Œ'] || p['æ–™è™Ÿ']);
                    if (allProducts.length === 0) {
                        showError('è®€å–æˆåŠŸä½†ç„¡è³‡æ–™');
                        return;
                    }
                    setupBrandFilter();
                    updateCategoryOptions(""); // åˆå§‹è¼‰å…¥æ‰€æœ‰åˆ†é¡
                    renderProducts(allProducts);
                    document.getElementById('loader').classList.add('hidden');
                },
                error: function() { showError('é€£ç·šå¤±æ•—ï¼è«‹æª¢æŸ¥ CSV ç™¼ä½ˆç¶²å€'); }
            });
        }

        function showError(msg) {
            document.getElementById('loader').innerHTML = `<div class="text-red-600 font-bold">${msg}</div>`;
        }

        // 2. å»ºç«‹å“ç‰Œé¸å–® (åªè·‘ä¸€æ¬¡)
        function setupBrandFilter() {
            const brandSelect = document.getElementById('brandFilter');
            const brands = [...new Set(allProducts.map(p => p['å“ç‰Œ']))].filter(Boolean).sort();
            brands.forEach(b => brandSelect.add(new Option(b, b)));

            // ç›£è½å“ç‰Œåˆ‡æ›ï¼šè§¸ç™¼åˆ†é¡é¸å–®æ›´æ–° + éæ¿¾ç”¢å“
            brandSelect.addEventListener('change', function() {
                updateCategoryOptions(this.value);
                filterContent(); 
            });
        }

        // 3. æ ¸å¿ƒåŠŸèƒ½ï¼šå‹•æ…‹æ›´æ–°åˆ†é¡é¸å–®
        function updateCategoryOptions(selectedBrand) {
            const categorySelect = document.getElementById('categoryFilter');
            const currentSelectedCat = categorySelect.value; // è¨˜ä½ç›®å‰é¸çš„åˆ†é¡

            let availableCats;
            if (selectedBrand === "") {
                availableCats = [...new Set(allProducts.map(p => p['åˆ†é¡']))].filter(Boolean).sort();
            } else {
                // éæ¿¾ï¼šåªæ‰¾å‡ºè©²å“ç‰Œä¸‹å­˜åœ¨çš„åˆ†é¡
                availableCats = [...new Set(
                    allProducts.filter(p => p['å“ç‰Œ'] === selectedBrand).map(p => p['åˆ†é¡'])
                )].filter(Boolean).sort();
            }

            categorySelect.innerHTML = '<option value="">æ‰€æœ‰åˆ†é¡</option>';
            availableCats.forEach(c => categorySelect.add(new Option(c, c)));

            // å¦‚æœåŸæœ¬é¸çš„åˆ†é¡åœ¨æ–°æ¸…å–®ä¹Ÿå­˜åœ¨ï¼Œå°±ä¿ç•™é¸æ“‡
            if (availableCats.includes(currentSelectedCat)) {
                categorySelect.value = currentSelectedCat;
            }
        }

        // 4. æœå°‹èˆ‡æ¸²æŸ“
        function renderProducts(data) {
            const grid = document.getElementById('productGrid');
            const countDisplay = document.getElementById('itemCount');
            grid.innerHTML = '';
            countDisplay.innerText = `ç”¢å“ç¸½æ•¸ï¼š${data.length}`;

            if (data.length === 0) {
                document.getElementById('noData').classList.remove('hidden');
                return;
            }
            document.getElementById('noData').classList.add('hidden');

            data.forEach(p => {
                const imgSrc = p['åœ–ç‰‡æª”å'] ? `images/${p['åœ–ç‰‡æª”å']}` : 'https://placehold.co/400x300?text=No+Image';
                const fileLink = p['å‹éŒ„æª”å'] ? p['å‹éŒ„æª”å'] : '#';
                
                grid.innerHTML += `
                    <div class="product-card bg-white border border-gray-100 rounded-2xl shadow-sm flex flex-col overflow-hidden group">
                        <div class="aspect-square bg-gray-50 flex items-center justify-center overflow-hidden">
                            <img src="${imgSrc}" class="w-full h-full object-contain group-hover:scale-105 transition-transform duration-500" onerror="this.src='https://placehold.co/400x300?text=Wait+Image'">
                        </div>
                        <div class="p-4 flex-grow">
                            <div class="flex items-center gap-2 mb-2">
                                <span class="bg-orange text-white text-[10px] font-black px-2 py-0.5 rounded shadow-sm">${p['å“ç‰Œ'] || 'GENTON'}</span>
                                <span class="text-gray-400 text-[10px] font-bold uppercase">${p['åˆ†é¡'] || 'General'}</span>
                            </div>
                            <h4 class="text-xs font-mono text-orange font-bold tracking-tighter mb-1">${p['æ–™è™Ÿ'] || '-'}</h4>
                            <h3 class="text-sm font-bold text-gray-700 leading-snug line-clamp-2 h-10">${p['å“é …'] || 'æœªå‘½åç”¢å“'}</h3>
                        </div>
                        <div class="p-4 pt-0">
                            <button onclick="if('${fileLink}'!=='#') window.open('${fileLink}'); else alert('ç›®å‰æš«ç„¡å‹éŒ„')" 
                                    class="w-full border-2 border-orange text-orange hover:bg-orange hover:text-white transition-all py-2 rounded-xl text-xs font-black">
                                VIEW SPEC
                            </button>
                        </div>
                    </div>`;
            });
        }

        function filterContent() {
            const kw = document.getElementById('keywordSearch').value.toLowerCase();
            const brand = document.getElementById('brandFilter').value;
            const cat = document.getElementById('categoryFilter').value;

            const filtered = allProducts.filter(p => {
                const searchStr = `${p['æ–™è™Ÿ']} ${p['å“é …']} ${p['åˆ†é¡']}`.toLowerCase();
                return searchStr.includes(kw) && 
                       (brand === "" || p['å“ç‰Œ'] === brand) && 
                       (cat === "" || p['åˆ†é¡'] === cat);
            });
            renderProducts(filtered);
        }

        document.getElementById('keywordSearch').addEventListener('input', filterContent);
        document.getElementById('categoryFilter').addEventListener('change', filterContent);

        init();
    </script>
</body>
</html>
