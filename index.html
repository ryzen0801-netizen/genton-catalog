<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ­£é€šç§‘æŠ€ - ç”¢å“ç›®éŒ„</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <style>
        body { font-family: "Microsoft JhengHei", sans-serif; background-color: #f9fafb; }
        .brand-orange { color: #F97316; }
        .bg-orange { background-color: #F97316; }
        .loading-spinner { border-top-color: #F97316; animation: spinner 1s linear infinite; }
        @keyframes spinner { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="text-gray-800">

    <nav class="bg-white shadow-sm border-b-4 border-orange sticky top-0 z-50 px-6 py-4 flex justify-between items-center">
        <h1 class="text-xl font-black brand-orange">æ­£é€šç§‘æŠ€ | <span class="text-gray-400 font-normal">PRODUCT</span></h1>
        <div id="itemCount" class="text-xs font-bold bg-gray-100 px-3 py-1 rounded-full">é€£ç·šä¸­...</div>
    </nav>

    <section class="bg-white border-b p-6">
        <div class="max-w-7xl mx-auto grid grid-cols-1 md:grid-cols-3 gap-4">
            <input type="text" id="keywordSearch" oninput="filterData()" placeholder="ğŸ” æœå°‹å‹è™Ÿæˆ–é—œéµå­—..." 
                   class="border-2 border-gray-100 p-3 rounded-xl focus:border-orange outline-none shadow-inner text-sm">
            
            <select id="brandFilter" onchange="updateCategoryMenu(); filterData();" class="border-2 border-gray-100 p-3 rounded-xl focus:border-orange outline-none bg-white text-sm">
                <option value="">æ‰€æœ‰å“ç‰Œ</option>
            </select>

            <select id="categoryFilter" onchange="filterData()" class="border-2 border-gray-100 p-3 rounded-xl focus:border-orange outline-none bg-white text-sm">
                <option value="">æ‰€æœ‰åˆ†é¡</option>
            </select>
        </div>
    </section>

    <main class="max-w-7xl mx-auto p-6 min-h-screen">
        <div id="loader" class="flex flex-col items-center py-20">
            <div class="loading-spinner w-10 h-10 border-4 border-gray-200 rounded-full mb-4"></div>
            <p class="text-gray-400">åŒæ­¥é›²ç«¯è³‡æ–™ä¸­...</p>
        </div>
        <div id="productGrid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6"></div>
        <div id="noData" class="hidden text-center py-20 text-gray-400">æ²’æœ‰æ‰¾åˆ°ç”¢å“</div>
    </main>

    <script>
        const csvUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSEaN95uQx-YbX1GKTcX8Og3GhmvgVNFgGocAopyg7bD6TvyUOOWUgiJAdbvX0GAKHpfs6dw0w2TGH3/pub?output=csv';
        let allProducts = [];
        let colMap = { brand: 'å“ç‰Œ', cat: 'åˆ†é¡', part: 'æ–™è™Ÿ', name: 'å“é …', file: 'å‹éŒ„æª”å' };

        function init() {
            Papa.parse(csvUrl, {
                download: true,
                header: true,
                skipEmptyLines: true,
                complete: function(results) {
                    const data = results.data;
                    if(data.length > 0) {
                        // è‡ªå‹•åµæ¸¬æ¬„ä½åç¨± (ç›¸å®¹ä¸åŒå¯«æ³•)
                        const first = data[0];
                        const keys = Object.keys(first);
                        colMap.brand = keys.find(k => k.includes('å“ç‰Œ') || k.includes('å» ç‰Œ')) || 'å“ç‰Œ';
                        colMap.cat = keys.find(k => k.includes('åˆ†é¡') || k.includes('é¡åˆ¥')) || 'åˆ†é¡';
                        colMap.part = keys.find(k => k.includes('æ–™è™Ÿ') || k.includes('å‹è™Ÿ')) || 'æ–™è™Ÿ';
                        colMap.name = keys.find(k => k.includes('å“é …') || k.includes('åç¨±')) || 'å“é …';
                        
                        allProducts = data.filter(p => p[colMap.brand] && p[colMap.part]);
                        
                        buildBrandMenu();
                        updateCategoryMenu(); // åˆå§‹è¼‰å…¥åˆ†é¡
                        filterData();
                        document.getElementById('loader').classList.add('hidden');
                    }
                }
            });
        }

        function buildBrandMenu() {
            const bSelect = document.getElementById('brandFilter');
            const brands = [...new Set(allProducts.map(p => p[colMap.brand]))].filter(Boolean).sort();
            brands.forEach(b => bSelect.add(new Option(b, b)));
        }

        // æ ¸å¿ƒï¼šé€£å‹•æ›´æ–°åˆ†é¡é¸å–®
        function updateCategoryMenu() {
            const bValue = document.getElementById('brandFilter').value;
            const cSelect = document.getElementById('categoryFilter');
            cSelect.innerHTML = '<option value="">æ‰€æœ‰åˆ†é¡</option>';

            // æ ¹æ“šé¸å®šçš„å“ç‰Œéæ¿¾å‡ºè©²å“ç‰Œæœ‰çš„åˆ†é¡
            const filteredData = bValue === "" ? allProducts : allProducts.filter(p => p[colMap.brand] === bValue);
            const cats = [...new Set(filteredData.map(p => p[colMap.cat]))].filter(Boolean).sort();

            cats.forEach(c => cSelect.add(new Option(c, c)));
        }

        function filterData() {
            const kw = document.getElementById('keywordSearch').value.toLowerCase();
            const b = document.getElementById('brandFilter').value;
            const c = document.getElementById('categoryFilter').value;
            const grid = document.getElementById('productGrid');
            
            const filtered = allProducts.filter(p => {
                const matchK = (p[colMap.name]+p[colMap.part]).toLowerCase().includes(kw);
                const matchB = b === "" || p[colMap.brand] === b;
                const matchC = c === "" || p[colMap.cat] === c;
                return matchK && matchB && matchC;
            });

            grid.innerHTML = '';
            document.getElementById('itemCount').innerText = `ITEMS: ${filtered.length}`;
            document.getElementById('noData').classList.toggle('hidden', filtered.length > 0);

            filtered.forEach(p => {
                const imgSrc = p['åœ–ç‰‡æª”å'] ? `images/${p['åœ–ç‰‡æª”å']}` : 'https://placehold.co/400x300?text=No+Image';
                grid.innerHTML += `
                    <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-4 hover:shadow-md transition">
                        <img src="${imgSrc}" class="w-full h-32 object-contain mb-4" onerror="this.src='https://placehold.co/400x300?text=Genton'">
                        <span class="text-[10px] bg-orange-100 text-orange-600 px-2 py-0.5 rounded font-bold">${p[colMap.brand]}</span>
                        <div class="text-xs text-gray-400 mt-1">${p[colMap.cat]}</div>
                        <div class="font-mono font-bold text-orange-500 text-sm mt-1">${p[colMap.part]}</div>
                        <div class="text-xs font-bold text-gray-700 mt-1 line-clamp-2 h-8">${p[colMap.name]}</div>
                        <button onclick="window.open('${p[colMap.file]||'#'}')" class="mt-4 w-full py-2 bg-gray-50 hover:bg-orange hover:text-white text-gray-500 rounded-lg text-[10px] font-bold transition">SPEC</button>
                    </div>`;
            });
        }

        init();
    </script>
</body>
</html>
