<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ­£é€šç§‘æŠ€ - ç”¢å“ç›®éŒ„</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <style>
        body { font-family: "Microsoft JhengHei", sans-serif; background-color: #f9fafb; }
        .brand-orange { color: #F97316; }
        .bg-orange { background-color: #F97316; }
        .loading-spinner { border-top-color: #F97316; animation: spinner 1s linear infinite; }
        @keyframes spinner { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="text-gray-800">

    <nav class="bg-white shadow-sm border-b-4 border-orange sticky top-0 z-50 px-6 py-4 flex justify-between items-center">
        <h1 class="text-xl font-black brand-orange">æ­£é€šç§‘æŠ€ | <span class="text-gray-400 font-normal">PRODUCT</span></h1>
        <div id="itemCount" class="text-xs font-bold bg-gray-100 px-3 py-1 rounded-full">é€£ç·šä¸­...</div>
    </nav>

    <section class="bg-white border-b p-6 shadow-sm">
        <div class="max-w-7xl mx-auto grid grid-cols-1 md:grid-cols-3 gap-4">
            <input type="text" id="keywordSearch" placeholder="ğŸ” æœå°‹å‹è™Ÿæˆ–é—œéµå­—..." 
                   class="border-2 border-gray-100 p-3 rounded-xl focus:border-orange outline-none shadow-inner text-sm">
            
            <select id="brandFilter" class="border-2 border-gray-100 p-3 rounded-xl focus:border-orange outline-none bg-white text-sm">
                <option value="">æ‰€æœ‰å“ç‰Œ</option>
            </select>

            <select id="categoryFilter" class="border-2 border-gray-100 p-3 rounded-xl focus:border-orange outline-none bg-white text-sm">
                <option value="">è«‹å…ˆé¸æ“‡å“ç‰Œ</option>
            </select>
        </div>
    </section>

    <main class="max-w-7xl mx-auto p-6 min-h-screen">
        <div id="loader" class="flex flex-col items-center py-20">
            <div class="loading-spinner w-10 h-10 border-4 border-gray-200 rounded-full mb-4"></div>
            <p class="text-gray-400">æ­£åœ¨ç²å–æœ€æ–°é›²ç«¯ç”¢å“è³‡æ–™...</p>
        </div>

        <div id="productGrid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6"></div>

        <div id="noData" class="hidden text-center py-20 text-gray-400">
            <p class="text-lg font-bold">æ²’æœ‰æ‰¾åˆ°ç¬¦åˆæ¢ä»¶çš„ç”¢å“</p>
        </div>
    </main>

    <script>
        const csvUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSEaN95uQx-YbX1GKTcX8Og3GhmvgVNFgGocAopyg7bD6TvyUOOWUgiJAdbvX0GAKHpfs6dw0w2TGH3/pub?output=csv';
        let allProducts = [];

        // åˆå§‹åŒ–ï¼šæŠ“å–è³‡æ–™
        function init() {
            Papa.parse(csvUrl, {
                download: true,
                header: true,
                skipEmptyLines: true,
                complete: function(results) {
                    allProducts = results.data.filter(p => p['å“ç‰Œ'] && p['æ–™è™Ÿ']);
                    if (allProducts.length === 0) {
                        alert("è­¦å‘Šï¼šé›²ç«¯è¡¨å–®è®€å–æˆåŠŸï¼Œä½†æ‰¾ä¸åˆ°ã€å“ç‰Œã€æˆ–ã€æ–™è™Ÿã€æ¬„ä½è³‡æ–™ï¼");
                        return;
                    }
                    buildBrandMenu(); // 1. å»ºç«‹å“ç‰Œé¸å–®
                    renderProducts(allProducts); // 2. åˆå§‹æ¸²æŸ“
                    document.getElementById('loader').classList.add('hidden');
                },
                error: function() { alert("é›²ç«¯è³‡æ–™è®€å–å¤±æ•—ï¼Œè«‹ç¢ºèª Google Sheets æ˜¯å¦ç™¼ä½ˆã€‚"); }
            });
        }

        // 1. å»ºç«‹ã€Œå“ç‰Œã€ä¸‹æ‹‰é¸å–®
        function buildBrandMenu() {
            const bSelect = document.getElementById('brandFilter');
            const brands = [...new Set(allProducts.map(p => p['å“ç‰Œ']))].sort();
            
            brands.forEach(b => {
                const opt = document.createElement('option');
                opt.value = b;
                opt.textContent = b;
                bSelect.appendChild(opt);
            });

            // ç•¶å“ç‰Œæ”¹è®Šæ™‚ï¼Œé€£å‹•æ›´æ–°åˆ†é¡
            bSelect.addEventListener('change', function() {
                buildCategoryMenu(this.value);
                filterData();
            });

            // åˆå§‹ä¹Ÿè·‘ä¸€æ¬¡åˆ†é¡é¸å–® (é¡¯ç¤ºæ‰€æœ‰åˆ†é¡)
            buildCategoryMenu("");
        }

        // 2. å»ºç«‹ã€Œé€£å‹•åˆ†é¡ã€é¸å–®
        function buildCategoryMenu(selectedBrand) {
            const cSelect = document.getElementById('categoryFilter');
            cSelect.innerHTML = '<option value="">æ‰€æœ‰åˆ†é¡</option>';

            let filteredCats = [];
            if (selectedBrand === "") {
                filteredCats = [...new Set(allProducts.map(p => p['åˆ†é¡']))].filter(Boolean).sort();
            } else {
                // é—œéµï¼šåªæŠ“å–å±¬æ–¼è©²å“ç‰Œçš„åˆ†é¡
                filteredCats = [...new Set(
                    allProducts.filter(p => p['å“ç‰Œ'] === selectedBrand).map(p => p['åˆ†é¡'])
                )].filter(Boolean).sort();
            }

            filteredCats.forEach(c => {
                const opt = document.createElement('option');
                opt.value = c;
                opt.textContent = c;
                cSelect.appendChild(opt);
            });
        }

        // 3. æ¸²æŸ“å¡ç‰‡
        function renderProducts(data) {
            const grid = document.getElementById('productGrid');
            const count = document.getElementById('itemCount');
            grid.innerHTML = '';
            count.innerText = `ITEMS: ${data.length}`;

            if (data.length === 0) {
                document.getElementById('noData').classList.remove('hidden');
                return;
            }
            document.getElementById('noData').classList.add('hidden');

            data.forEach(p => {
                const imgSrc = p['åœ–ç‰‡æª”å'] ? `images/${p['åœ–ç‰‡æª”å']}` : 'https://placehold.co/400x300?text=No+Image';
                const card = `
                    <div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden flex flex-col p-4 hover:shadow-md transition">
                        <img src="${imgSrc}" class="w-full h-40 object-contain mb-4" onerror="this.src='https://placehold.co/400x300?text=Genton'">
                        <div class="flex-grow">
                            <span class="text-[10px] bg-orange-100 text-orange-600 px-2 py-0.5 rounded font-bold">${p['å“ç‰Œ']}</span>
                            <div class="text-xs text-gray-400 mt-1">${p['åˆ†é¡']}</div>
                            <div class="font-mono font-bold text-orange-500 mt-1">${p['æ–™è™Ÿ']}</div>
                            <div class="text-sm font-bold text-gray-700 mt-1 line-clamp-2">${p['å“é …']}</div>
                        </div>
                        <button onclick="window.open('${p['å‹éŒ„æª”å']||'#'}')" class="mt-4 w-full py-2 bg-gray-50 hover:bg-orange hover:text-white text-gray-500 rounded-lg text-xs font-bold transition">VIEW DETAIL</button>
                    </div>`;
                grid.innerHTML += card;
            });
        }

        // 4. ç¶œåˆéæ¿¾
        function filterData() {
            const kw = document.getElementById('keywordSearch').value.toLowerCase();
            const b = document.getElementById('brandFilter').value;
            const c = document.getElementById('categoryFilter').value;

            const filtered = allProducts.filter(p => {
                const matchK = p['å“é …'].toLowerCase().includes(kw) || p['æ–™è™Ÿ'].toLowerCase().includes(kw);
                const matchB = b === "" || p['å“ç‰Œ'] === b;
                const matchC = c === "" || p['åˆ†é¡'] === c;
                return matchK && matchB && matchC;
            });
            renderProducts(filtered);
        }

        // ç›£è½
        document.getElementById('keywordSearch').addEventListener('input', filterData);
        document.getElementById('categoryFilter').addEventListener('change', filterData);

        init();
    </script>
</body>
</html>
