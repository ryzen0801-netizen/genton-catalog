<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ­£é€šç§‘æŠ€ - é›²ç«¯ç”¢å“æŸ¥è©¢ç³»çµ±</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <style>
        body { font-family: "Microsoft JhengHei", sans-serif; background-color: #fff; }
        .brand-orange { color: #F97316; }
        .bg-orange { background-color: #F97316; }
        .border-orange { border-color: #F97316; }
        .loading-spinner { border-top-color: #F97316; animation: spinner 1.5s linear infinite; }
        @keyframes spinner { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="text-gray-800">

    <nav class="bg-white shadow-md border-b-4 border-orange sticky top-0 z-50 px-6 py-4">
        <div class="max-w-7xl mx-auto flex justify-between items-center">
            <h1 class="text-2xl font-bold brand-orange">æ­£é€šç§‘æŠ€ <span class="text-gray-400 text-lg font-normal ml-2 italic">Product Finder</span></h1>
            <div id="itemCount" class="text-sm bg-gray-100 px-3 py-1 rounded-full text-gray-500 font-bold">è®€å–ä¸­...</div>
        </div>
    </nav>

    <section class="bg-orange/5 border-b border-orange/10 p-6">
        <div class="max-w-7xl mx-auto grid grid-cols-1 md:grid-cols-3 gap-4">
            <input type="text" id="keywordSearch" placeholder="ğŸ” è¼¸å…¥é—œéµå­—ã€æ–™è™Ÿæˆ–è¦æ ¼..." 
                   class="md:col-span-1 border-2 border-gray-200 p-3 rounded-xl focus:border-orange outline-none shadow-sm">
            
            <select id="brandFilter" class="border-2 border-gray-200 p-3 rounded-xl focus:border-orange outline-none shadow-sm">
                <option value="">æ‰€æœ‰å“ç‰Œ</option>
            </select>

            <select id="categoryFilter" class="border-2 border-gray-200 p-3 rounded-xl focus:border-orange outline-none shadow-sm">
                <option value="">æ‰€æœ‰åˆ†é¡</option>
            </select>
        </div>
    </section>

    <main class="max-w-7xl mx-auto p-6">
        <div id="loader" class="flex flex-col items-center py-20">
            <div class="loading-spinner w-12 h-12 border-4 border-gray-200 rounded-full mb-4"></div>
            <p class="text-gray-500">æ­£åœ¨åŒæ­¥æœ€æ–°ç”¢å“è³‡æ–™...</p>
        </div>

        <div id="productGrid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
            </div>

        <div id="noData" class="hidden text-center py-20">
            <p class="text-xl text-gray-400 font-bold">æ‰¾ä¸åˆ°ç›¸ç¬¦çš„ç”¢å“ï¼Œè«‹å˜—è©¦ç¸®çŸ­é—œéµå­—</p>
        </div>
    </main>

<script>
    // --- è¨­å®šå€ ---
    const csvUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSEaN95uQx-YbX1GKTcX8Og3GhmvgVNFgGocAopyg7bD6TvyUOOWUgiJAdbvX0GAKHpfs6dw0w2TGH3/pub?output=csv';
    // --------------

    let allProducts = [];

    function init() {
        Papa.parse(csvUrl, {
            download: true,
            header: true,
            skipEmptyLines: true, // è‡ªå‹•è·³éç©ºç™½è¡Œ
            complete: function(results) {
                console.log("è³‡æ–™è®€å–æˆåŠŸ:", results.data); // é™¤éŒ¯ç”¨
                // åªè¦æœ‰å“ç‰Œæˆ–æ–™è™Ÿå°±è¦–ç‚ºæœ‰æ•ˆè³‡æ–™
                allProducts = results.data.filter(p => p['å“ç‰Œ'] || p['æ–™è™Ÿ']);
                
                if (allProducts.length === 0) {
                    document.getElementById('loader').innerHTML = '<p class="text-red-500">è®€å–æˆåŠŸä½†æ²’è³‡æ–™ï¼Œè«‹æª¢æŸ¥ Google Sheets æ¨™é¡Œæ˜¯å¦æ­£ç¢ºï¼ˆå¿…é ˆæœ‰ï¼šå“ç‰Œã€åˆ†é¡ã€æ–™è™Ÿã€å“é …ï¼‰</p>';
                    return;
                }

                setupFilters();
                renderProducts(allProducts);
                document.getElementById('loader').classList.add('hidden');
            },
            error: function(err) {
                document.getElementById('loader').innerHTML = '<p class="text-red-500">é€£ç·šå¤±æ•—ï¼è«‹ç¢ºèª Google Sheets æ˜¯å¦å·²ã€Œç™¼ä½ˆåˆ°ç¶²è·¯ã€ä¸”é¸æ“‡ã€ŒCSVã€æ ¼å¼ã€‚</p>';
            }
        });
    }

    function setupFilters() {
        const brands = [...new Set(allProducts.map(p => p['å“ç‰Œ']))].filter(Boolean).sort();
        const categories = [...new Set(allProducts.map(p => p['åˆ†é¡']))].filter(Boolean).sort();
        
        const bSelect = document.getElementById('brandFilter');
        const cSelect = document.getElementById('categoryFilter');

        brands.forEach(b => bSelect.innerHTML += `<option value="${b}">${b}</option>`);
        categories.forEach(c => cSelect.innerHTML += `<option value="${c}">${c}</option>`);
    }

    function renderProducts(data) {
        const grid = document.getElementById('productGrid');
        const noData = document.getElementById('noData');
        const countDisplay = document.getElementById('itemCount');
        
        grid.innerHTML = '';
        countDisplay.innerText = `ç”¢å“ç¸½æ•¸ï¼š${data.length}`;

        if (data.length === 0) {
            noData.classList.remove('hidden');
            return;
        }
        noData.classList.add('hidden');

        data.forEach(p => {
            const imgSrc = p['åœ–ç‰‡æª”å'] ? `images/${p['åœ–ç‰‡æª”å']}` : 'https://placehold.co/400x300?text=No+Image';
            
            const card = `
                <div class="bg-white border border-gray-100 rounded-2xl shadow-sm hover:shadow-xl transition-all duration-300 flex flex-col overflow-hidden group">
                    <div class="aspect-square bg-gray-50 flex items-center justify-center overflow-hidden">
                        <img src="${imgSrc}" class="w-full h-full object-contain group-hover:scale-110 transition-transform duration-500" onerror="this.src='https://placehold.co/400x300?text=Wait+Image'">
                    </div>
                    <div class="p-4 flex-grow">
                        <div class="flex items-center gap-2 mb-2">
                            <span class="bg-orange text-white text-[10px] font-bold px-2 py-0.5 rounded">${p['å“ç‰Œ'] || 'æœªçŸ¥å“ç‰Œ'}</span>
                            <span class="text-gray-400 text-xs">${p['åˆ†é¡'] || 'æœªåˆ†é¡'}</span>
                        </div>
                        <h4 class="text-xs font-mono text-orange font-bold">${p['æ–™è™Ÿ'] || '-'}</h4>
                        <h3 class="text-sm font-bold text-gray-700 mt-1 line-clamp-2">${p['å“é …'] || 'ç„¡ç”¢å“åç¨±'}</h3>
                    </div>
                    <div class="p-4 pt-0">
                        <button onclick="window.open('${p['å‹éŒ„æª”å'] || '#'}')" class="w-full border border-orange text-orange hover:bg-orange hover:text-white transition py-2 rounded-lg text-sm font-bold">æŸ¥çœ‹è¦æ ¼</button>
                    </div>
                </div>
            `;
            grid.innerHTML += card;
        });
    }

    function filterContent() {
        const keyword = document.getElementById('keywordSearch').value.toLowerCase();
        const brand = document.getElementById('brandFilter').value;
        const cat = document.getElementById('categoryFilter').value;

        const filtered = allProducts.filter(p => {
            const matchK = (p['æ–™è™Ÿ'] || '').toLowerCase().includes(keyword) || (p['å“é …'] || '').toLowerCase().includes(keyword);
            const matchB = brand === "" || p['å“ç‰Œ'] === brand;
            const matchC = cat === "" || p['åˆ†é¡'] === cat;
            return matchK && matchB && matchC;
        });
        renderProducts(filtered);
    }

    document.getElementById('keywordSearch').addEventListener('input', filterContent);
    document.getElementById('brandFilter').addEventListener('change', filterContent);
    document.getElementById('categoryFilter').addEventListener('change', filterContent);

    // å•Ÿå‹•ç¨‹å¼ (æª¢æŸ¥ç¶²å€æ˜¯å¦åŒ…å« google sheets é—œéµå­—)
    if (csvUrl.includes('google.com/spreadsheets')) {
        init();
    } else {
        document.getElementById('loader').innerHTML = '<p class="text-red-500 font-bold">è«‹åœ¨ç¨‹å¼ç¢¼ä¸­å¡«å…¥æ­£ç¢ºçš„ CSV ç¶²å€</p>';
    }
</script>
</body>

</html>
